# ğŸ¯ Kepler Asteroid Integration - Visual Flow

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                           â”‚
â”‚                      (Asteroid Control Panel)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Click "Belt Asteroid" button
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           createCustomAsteroidObject() FUNCTION                  â”‚
â”‚                                                                  â”‚
â”‚  Input: { distanceAU: 2.5, eccentricity: 0.2, ... }            â”‚
â”‚                                                                  â”‚
â”‚  Creates CelestialBody with:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ orbitalElements: {                          â”‚                â”‚
â”‚  â”‚   semiMajorAxis: 2.5 AU                    â”‚                â”‚
â”‚  â”‚   eccentricity: 0.2                        â”‚                â”‚
â”‚  â”‚   inclination: 10Â°                         â”‚                â”‚
â”‚  â”‚   longitudeOfAscendingNode: 145Â°           â”‚                â”‚
â”‚  â”‚   argumentOfPerihelion: 87Â°                â”‚                â”‚
â”‚  â”‚   meanAnomaly: 234Â° (random start)         â”‚                â”‚
â”‚  â”‚   period: âˆš(2.5Â³) = 3.95 years             â”‚                â”‚
â”‚  â”‚ }                                           â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ onAddCustomObject(asteroid)
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       APP STATE (page.tsx)                       â”‚
â”‚                                                                  â”‚
â”‚  customObjects = [...customObjects, newAsteroid]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Pass customObjects prop
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SOLAR SYSTEM COMPONENT                          â”‚
â”‚                   (solar-system.tsx)                             â”‚
â”‚                                                                  â”‚
â”‚  useEffect(() => {                                              â”‚
â”‚    customObjects.forEach(obj => {                               â”‚
â”‚      // Create or find mesh                                     â”‚
â”‚      // Calculate orbit path                                    â”‚
â”‚      // Add to scene                                            â”‚
â”‚    })                                                            â”‚
â”‚  }, [customObjects])                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ For each asteroid
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CREATE MESH (ONE TIME)                        â”‚
â”‚                                                                  â”‚
â”‚  1. Geometry:                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚ Asteroid: IcosahedronGeometry    â”‚                        â”‚
â”‚     â”‚           + random deformation   â”‚                        â”‚
â”‚     â”‚ Comet: SphereGeometry (elongated)â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                  â”‚
â”‚  2. Material:                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚ Texture: 2k_moon.jpg             â”‚                        â”‚
â”‚     â”‚ Color: Custom tint               â”‚                        â”‚
â”‚     â”‚ Roughness: 0.95 (rocky)          â”‚                        â”‚
â”‚     â”‚ Metalness: 0.1                   â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                  â”‚
â”‚  3. Special Effects:                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚ Comet â†’ 500 particle tail        â”‚                        â”‚
â”‚     â”‚ Points away from Sun             â”‚                        â”‚
â”‚     â”‚ Pulsing brightness               â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ scene.add(mesh)
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CREATE ORBIT PATH (ONE TIME)                    â”‚
â”‚                                                                  â”‚
â”‚  for i = 0 to 256:                                              â”‚
â”‚    Î¸ = (i / 256) Ã— 2Ï€                                           â”‚
â”‚                                                                  â”‚
â”‚    // Elliptical orbit equation                                 â”‚
â”‚    r = a(1 - eÂ²) / (1 + eÂ·cos(Î¸))                              â”‚
â”‚                                                                  â”‚
â”‚    // Position in orbital plane                                 â”‚
â”‚    x_orbital = r Ã— cos(Î¸)                                       â”‚
â”‚    y_orbital = r Ã— sin(Î¸)                                       â”‚
â”‚                                                                  â”‚
â”‚    // Apply 3D rotations:                                       â”‚
â”‚    1. Rotate by argument of perihelion (Ï‰)                      â”‚
â”‚    2. Apply inclination (i) - tilt orbit plane                  â”‚
â”‚    3. Rotate by longitude of ascending node (Î©)                 â”‚
â”‚                                                                  â”‚
â”‚    points.push(x3, z3, y3)                                      â”‚
â”‚                                                                  â”‚
â”‚  orbitLine = new Line(points, material)                         â”‚
â”‚  scene.add(orbitLine)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Every frame (60 FPS)
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ANIMATION LOOP (EVERY FRAME)                        â”‚
â”‚                                                                  â”‚
â”‚  currentTime = simulationTime Ã— timeSpeed                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 1: Calculate Mean Anomaly                â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ n = 2Ï€ / period (mean motion)                 â”‚             â”‚
â”‚  â”‚ M = Mâ‚€ + nÂ·t (current angle)                  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 2: Solve Kepler's Equation               â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ E - eÂ·sin(E) = M                              â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ Newton-Raphson iteration:                     â”‚             â”‚
â”‚  â”‚ Eâ‚ = Eâ‚€ - f(Eâ‚€)/f'(Eâ‚€)                        â”‚             â”‚
â”‚  â”‚ where:                                         â”‚             â”‚
â”‚  â”‚   f(E) = E - eÂ·sin(E) - M                     â”‚             â”‚
â”‚  â”‚   f'(E) = 1 - eÂ·cos(E)                        â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ Iterate until |Eâ‚ - Eâ‚€| < 1e-6               â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 3: Calculate True Anomaly                â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ Î½ = 2Â·atan2(                                  â”‚             â”‚
â”‚  â”‚   âˆš(1 + e)Â·sin(E/2),                          â”‚             â”‚
â”‚  â”‚   âˆš(1 - e)Â·cos(E/2)                           â”‚             â”‚
â”‚  â”‚ )                                              â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 4: Calculate Distance                    â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ r = a(1 - eÂ·cos(E))                           â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 5: Position in Orbital Plane             â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ x = rÂ·cos(Î½)                                  â”‚             â”‚
â”‚  â”‚ y = rÂ·sin(Î½)                                  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 6: Apply 3D Rotations                    â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ 1. Rotate by Ï‰ (perihelion argument)          â”‚             â”‚
â”‚  â”‚ 2. Apply i (inclination)                      â”‚             â”‚
â”‚  â”‚ 3. Rotate by Î© (ascending node)               â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 7: Convert to Scene Units                â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ sceneX = x_AU Ã— 28 (Earth = 28 units)         â”‚             â”‚
â”‚  â”‚ sceneY = z_AU Ã— 28                            â”‚             â”‚
â”‚  â”‚ sceneZ = y_AU Ã— 28                            â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 8: Update Mesh Position                  â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ mesh.position.set(sceneX, sceneY, sceneZ)     â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ // Rotation (tumbling for asteroids)          â”‚             â”‚
â”‚  â”‚ mesh.rotation.x = time Ã— 0.02                 â”‚             â”‚
â”‚  â”‚ mesh.rotation.y = time Ã— 0.015                â”‚             â”‚
â”‚  â”‚ mesh.rotation.z = time Ã— 0.008                â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ STEP 9: Update Comet Tail (if comet)          â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ directionToSun = -mesh.position.normalize()   â”‚             â”‚
â”‚  â”‚ directionAway = -directionToSun               â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ tail.quaternion.setFromUnitVectors(           â”‚             â”‚
â”‚  â”‚   defaultDirection,                            â”‚             â”‚
â”‚  â”‚   directionAway                                â”‚             â”‚
â”‚  â”‚ )                                              â”‚             â”‚
â”‚  â”‚                                                â”‚             â”‚
â”‚  â”‚ brightness = 1.5 - (distance/50)              â”‚             â”‚
â”‚  â”‚ tail.opacity = brightness Ã— 0.6               â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ renderer.render(scene, camera)
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RENDERED FRAME                              â”‚
â”‚                                                                  â”‚
â”‚         â˜€ï¸  Sun (center, glowing)                               â”‚
â”‚                                                                  â”‚
â”‚     ğŸŒ Earth (28 units, circular orbit)                         â”‚
â”‚                                                                  â”‚
â”‚   ğŸŒ‘ Asteroid (70 units, elliptical orbit)                      â”‚
â”‚      - Tumbling rotation                                        â”‚
â”‚      - Orange orbit line                                        â”‚
â”‚      - Rocky texture                                            â”‚
â”‚                                                                  â”‚
â”‚  â˜„ï¸  Comet (280 units, eccentric orbit)                         â”‚
â”‚     - Cyan particle tail pointing away from Sun                 â”‚
â”‚     - Elongated nucleus                                         â”‚
â”‚     - Icy blue glow                                             â”‚
â”‚                                                                  â”‚
â”‚                    User can:                                     â”‚
â”‚                    - Click objects â†’ Impact analysis             â”‚
â”‚                    - Zoom/pan camera                            â”‚
â”‚                    - Switch realistic mode                       â”‚
â”‚                    - Control time speed                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Timeline

```
Time = 0 (Initial)
â”‚
â”œâ”€ User clicks "Belt Asteroid"
â”‚   â””â”€ createCustomAsteroidObject({ distanceAU: 2.5, e: 0.2 })
â”‚       â””â”€ Returns: { id, name, orbitalElements: {...} }
â”‚
â”œâ”€ State updated: customObjects = [asteroid]
â”‚
â”œâ”€ SolarSystem component re-renders
â”‚   â”œâ”€ Creates irregular icosahedron mesh
â”‚   â”œâ”€ Loads moon texture
â”‚   â”œâ”€ Generates 256-point orbit path
â”‚   â””â”€ Adds to scene
â”‚
â””â”€ Animation starts (60 FPS)

Time = 0.0167s (1 frame)
â”‚
â”œâ”€ Calculate M = Mâ‚€ + nÂ·0.0167
â”œâ”€ Solve E from Kepler's equation
â”œâ”€ Calculate Î½ (true anomaly)
â”œâ”€ Calculate r (distance)
â”œâ”€ Calculate position (x, y, z)
â”œâ”€ Apply rotations (Ï‰, i, Î©)
â”œâ”€ Update mesh.position
â””â”€ Render frame

Time = 0.0334s (2 frames)
â”‚
â”œâ”€ Calculate M = Mâ‚€ + nÂ·0.0334
â”œâ”€ ... (same steps)
â””â”€ Asteroid moved slightly along orbit

Time = 1 year (simulated)
â”‚
â”œâ”€ Asteroid completed ~0.25 orbits (period = 3.95 years)
â”œâ”€ Position calculated using same Kepler equations
â””â”€ Smooth elliptical motion visible

Time = 3.95 years (simulated)
â”‚
â”œâ”€ Asteroid completed exactly 1 full orbit
â”œâ”€ Returns to starting position (M = Mâ‚€ + 2Ï€)
â””â”€ Cycle repeats
```

---

## Comparison: Your Code vs Integrated Code

### Your Standalone Component:
```typescript
// useFrame hook (every frame)
const M = (n * elapsedDays) % (2 * Math.PI)
const E = solveKepler(M, e)
const v = 2 * Math.atan2(...)
const r = a * (1 - e * e) / (1 + e * Math.cos(v))
ref.current.position.set(posX, 0, posZ)
```

### Integrated Code:
```typescript
// Animation loop (every frame)
const position = calculateOrbitalPosition(
  obj.orbitalElements,
  currentSimTime
)
// calculateOrbitalPosition internally:
//   1. Updates M based on time
//   2. Calls solveKeplerEquation(M, e)
//   3. Calculates true anomaly
//   4. Calculates distance
//   5. Applies 3D rotations
//   6. Returns {x, y, z} in AU

mesh.position.set(
  position.x * 28,  // Convert AU to scene units
  position.z * 28,
  position.y * 28
)
```

**Same physics, same math, just integrated!**

---

## Key Points

âœ… **Kepler's Equation:** E - eÂ·sin(E) = M (solved every frame)  
âœ… **Elliptical Orbit:** r = a(1 - eÂ²)/(1 + eÂ·cos(Î½))  
âœ… **3D Rotations:** Inclination, perihelion, ascending node  
âœ… **Kepler's 3rd Law:** TÂ² = aÂ³ (period calculation)  
âœ… **Three.js Scene:** Meshes, lines, particles integrated  
âœ… **60 FPS Animation:** Smooth orbital motion  
âœ… **State Management:** React state â†’ Three.js meshes  

---

## Example Calculation

**Belt Asteroid at 2.5 AU:**

```
Given:
- a = 2.5 AU
- e = 0.2
- i = 10Â°
- Î© = 145Â°
- Ï‰ = 87Â°
- Mâ‚€ = 234Â°
- time = 0.5 years

Step 1: Mean Motion
n = 2Ï€ / T
T = âˆš(aÂ³) = âˆš(2.5Â³) = 3.95 years
n = 2Ï€ / 3.95 = 1.59 rad/year

Step 2: Current Mean Anomaly
M = Mâ‚€ + nÂ·t
M = 234Â° + (1.59 rad/year Ã— 0.5 years)
M = 234Â° + 45.6Â° = 279.6Â° = 4.88 rad

Step 3: Solve Kepler's Equation
E - 0.2Â·sin(E) = 4.88
Eâ‚€ = 4.88 (initial guess)
Eâ‚ = Eâ‚€ - (Eâ‚€ - 0.2Â·sin(Eâ‚€) - 4.88) / (1 - 0.2Â·cos(Eâ‚€))
... (iterate until convergence)
E â‰ˆ 5.05 rad

Step 4: True Anomaly
Î½ = 2Â·atan2(âˆš(1.2)Â·sin(2.525), âˆš(0.8)Â·cos(2.525))
Î½ â‰ˆ 5.25 rad â‰ˆ 301Â°

Step 5: Distance
r = 2.5(1 - 0.2Â·cos(5.05))
r â‰ˆ 2.19 AU

Step 6: Position in Orbital Plane
x = 2.19Â·cos(301Â°) = 1.14 AU
y = 2.19Â·sin(301Â°) = -1.87 AU

Step 7: Apply Rotations
[Apply Ï‰, i, Î© matrices]
Final: x = 0.82 AU, y = 0.45 AU, z = -1.95 AU

Step 8: Convert to Scene Units
sceneX = 0.82 Ã— 28 = 23 units
sceneY = -1.95 Ã— 28 = -55 units
sceneZ = 0.45 Ã— 28 = 13 units

Step 9: Update Position
mesh.position.set(23, -55, 13)
```

**Result:** Asteroid visible at (23, -55, 13) in scene! âœ¨
